<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Ruby‚Äôs Cafeteria Rewards ‚Äî Display</title>

  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@600&display=swap" rel="stylesheet">

  <style>
    :root{ --navy:#0a1f44; --navy2:#102b5c; --red:#ff5252; }
    body{
      font-family:"Baloo 2", cursive;
      margin:0; padding:18px;
      color:#fff;
      background:linear-gradient(var(--navy), var(--navy2));
      text-align:center;
    }
    h1{ margin:6px 0 0; color:var(--red); font-size:44px; }
    .sub{ margin:6px 0 14px; opacity:.95; font-size:20px; }

    .toprow{
      display:flex; gap:12px; flex-wrap:wrap; justify-content:center; align-items:center;
      margin: 10px 0 16px;
    }
    .badge{
      background:rgba(255,255,255,.12);
      border:2px solid rgba(255,255,255,.18);
      padding:8px 14px;
      border-radius:999px;
      font-size:16px;
    }

    .jars{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(250px,1fr));
      gap:16px;
      align-items:start;
      margin-top:6px;
    }
    .jar{
      background:#fff;
      color:var(--navy);
      border-radius:22px;
      padding:14px;
      box-shadow:0 12px 26px rgba(0,0,0,.25);
    }
    .jar h3{ margin:6px 0 10px; font-size:22px; }
    .jar-lid{
      width:104px; height:24px; margin:0 auto;
      background:var(--red);
      border-radius:12px 12px 0 0;
      box-shadow: inset 0 -3px 0 rgba(0,0,0,.12);
    }
    .jar-body{
      width:100%; height:180px;
      border:4px solid var(--navy);
      border-radius:0 0 22px 22px;
      margin-top:6px;
      position:relative;
      overflow:hidden;
      background:#f7fbff;
    }
    .fill{
      position:absolute; left:0; right:0; bottom:0;
      height:0%;
      background:linear-gradient(#ffb3b3, var(--red));
      opacity:.35;
      transition:height .6s ease;
      z-index:1;
    }
    .tokens{
      position:absolute; inset:0;
      pointer-events:none;
      z-index:3;
    }
    .token{
      position:absolute;
      width:16px; height:16px;
      border-radius:50%;
      background: radial-gradient(circle at 30% 30%, #fff7b0 0%, #ffd700 40%, #d4a400 100%);
      box-shadow: 0 2px 0 rgba(0,0,0,0.15);
      transform: translate(-50%, -50%);
    }
    .points{
      font-size:34px;
      margin:10px 0 2px;
    }
    .tiny{ font-size:14px; opacity:.85; margin-top:6px; }

    .leaderboard{
      margin:18px auto 0;
      max-width:980px;
      background:#fff;
      color:var(--navy);
      border-radius:22px;
      padding:14px;
      box-shadow:0 12px 26px rgba(0,0,0,.22);
      text-align:left;
    }
    .leaderboard h2{ text-align:center; margin:6px 0 10px; }
    .lbgrid{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(180px,1fr));
      gap:10px;
    }
    .lbitem{
      background:#f3f7ff;
      border:2px dashed rgba(10,31,68,.25);
      padding:10px 12px;
      border-radius:16px;
    }
    /* Ruby pop animation overlay */
.ruby-pop{
  position: fixed;
  right: 18px;
  bottom: 18px;
  width: 320px;
  max-width: 90vw;
  pointer-events: none;
  opacity: 0;
  transform: translateY(20px) scale(0.95);
  z-index: 9998;
}

.ruby-pop.show{
  opacity: 1;
  animation: rubyPopIn 220ms ease-out forwards;
}

@keyframes rubyPopIn{
  to { transform: translateY(0) scale(1); }
}

.ruby-bubble{
  position: relative;
  background: rgba(255,255,255,0.97);
  color: #0a1f44;
  border-radius: 22px;
  padding: 12px 12px 8px;
  box-shadow: 0 16px 34px rgba(0,0,0,0.25);
  border: 3px solid rgba(255,82,82,0.35);
  overflow: hidden;
}

.ruby-say{
  font-size: 18px;
  margin: 2px 0 6px;
}

.ruby-svg{
  width: 240px;
  height: 240px;
  display: block;
  margin: 0 auto;
  animation: rubyBounce 1.2s ease-in-out infinite;
  transform-origin: 50% 85%;
}

@keyframes rubyBounce{
  0%, 100%{ transform: translateY(0); }
  50%{ transform: translateY(-8px); }
}

.ruby-wing{
  transform-origin: 50% 50%;
  animation: rubyFlap 320ms ease-in-out infinite;
}
.ruby-wing-left{ transform-origin: 62px 148px; }
.ruby-wing-right{ transform-origin: 158px 148px; }

@keyframes rubyFlap{
  0%,100%{ transform: rotate(0deg); }
  50%{ transform: rotate(8deg); }
}

/* sparkles */
.ruby-spark{
  position:absolute;
  font-size: 20px;
  opacity: 0;
  animation: sparkle 900ms ease-out infinite;
}
.ruby-spark-1{ left: 18px; top: 54px; animation-delay: 0ms; }
.ruby-spark-2{ right: 18px; top: 72px; animation-delay: 220ms; }
.ruby-spark-3{ right: 56px; top: 24px; animation-delay: 120ms; }

@keyframes sparkle{
  0%{ transform: translateY(8px) scale(0.8); opacity: 0; }
  35%{ opacity: 1; }
  100%{ transform: translateY(-10px) scale(1.1); opacity: 0; }
}
.banner-pop{
  position: fixed;
  left: 50%;
  bottom: 20px;
  transform: translateX(-50%) translateY(30px) scale(0.98);
  opacity: 0;
  z-index: 9999;
  pointer-events: none;
  width: min(900px, 94vw);
}

.banner-pop.show{
  opacity: 1;
  animation: bannerIn 220ms ease-out forwards;
}

@keyframes bannerIn{
  to { transform: translateX(-50%) translateY(0) scale(1); }
}

.banner-wrap{
  position: relative;
  filter: drop-shadow(0 18px 30px rgba(0,0,0,0.35));
}

.banner-img{
  width: 100%;
  height: auto;
  display: block;
  border-radius: 18px;
}

.banner-text{
  position: absolute;
  left: 6.5%;
  top: 36%;
  width: 70%;
  text-align: left;
  font-size: clamp(22px, 3.6vw, 54px);
  color: #111;
  font-weight: 700;
  text-shadow: 0 3px 0 rgba(255,255,255,0.75);
}


    .confetti{
      position:fixed;
      width:10px; height:10px;
      border-radius:2px;
      z-index:9999;
      animation: fall 900ms linear forwards;
    }
    @keyframes fall{
      to{ transform: translateY(115vh) rotate(520deg); opacity:0; }
    }
  </style>
</head>
<body>
  <audio id="pointSound" preload="auto">
  <source src="https://assets.mixkit.co/sfx/preview/mixkit-positive-notification-951.mp3" type="audio/mpeg">
</audio>

  <h1>üê¶ Ruby‚Äôs Cafeteria Rewards</h1>
  <div class="sub">Great expectations = great behavior üíô‚ù§Ô∏è</div>

  <div class="toprow">
    <div class="badge">üì£ Display Mode (Projector)</div>
    <div class="badge" id="status">Connecting‚Ä¶</div>
    <div class="badge" id="lastUpdate">Last update: ‚Äî</div>
  </div>
  <!-- Ruby Mascot Pop (appears on big moments like +5) -->
<div id="rubyPop" class="ruby-pop" aria-hidden="true">
  <div class="ruby-bubble">
    <div class="ruby-say">Ruby says: Nice job! ‚≠ê</div>

    <!-- Cute Ruby (SVG) -->
    <svg class="ruby-svg" viewBox="0 0 220 220" xmlns="http://www.w3.org/2000/svg">
      <!-- shadow -->
      <ellipse cx="110" cy="200" rx="60" ry="10" fill="rgba(0,0,0,0.15)"/>

      <!-- body -->
      <ellipse cx="110" cy="130" rx="62" ry="70" fill="#ff5252"/>
      <ellipse cx="110" cy="150" rx="36" ry="45" fill="#ff9a9a" opacity="0.75"/>

      <!-- head -->
      <circle cx="110" cy="70" r="52" fill="#ff5252"/>

      <!-- crest -->
      <path d="M85 28 C95 8, 110 8, 116 30 C106 26, 96 26, 85 28Z" fill="#ff6b6b"/>
      <path d="M105 24 C120 4, 138 10, 140 34 C128 26, 116 24, 105 24Z" fill="#ff6b6b"/>

      <!-- face patch -->
      <path d="M75 74 C90 58, 130 58, 145 74 C130 95, 90 95, 75 74Z" fill="#ffffff" opacity="0.95"/>

      <!-- eyes -->
      <g>
        <circle cx="92" cy="72" r="12" fill="#0a1f44"/>
        <circle cx="92" cy="68" r="4" fill="#ffffff"/>
        <circle cx="128" cy="72" r="12" fill="#0a1f44"/>
        <circle cx="128" cy="68" r="4" fill="#ffffff"/>
      </g>

      <!-- beak -->
      <path d="M110 86 L150 98 L110 110 L110 86Z" fill="#ffd700" stroke="#d4a400" stroke-width="3" stroke-linejoin="round"/>
      <path d="M110 98 L150 98" stroke="#d4a400" stroke-width="3" stroke-linecap="round"/>

      <!-- wings (animated) -->
      <g class="ruby-wing ruby-wing-left">
        <path d="M58 120 C25 130, 18 160, 40 176 C54 168, 66 154, 72 140 C74 132, 70 124, 58 120Z"
              fill="#ff3b3b"/>
        <path d="M50 140 C38 146, 36 160, 46 168" stroke="rgba(10,31,68,0.25)" stroke-width="6" stroke-linecap="round"/>
      </g>

      <g class="ruby-wing ruby-wing-right">
        <path d="M162 120 C195 130, 202 160, 180 176 C166 168, 154 154, 148 140 C146 132, 150 124, 162 120Z"
              fill="#ff3b3b"/>
        <path d="M170 140 C182 146, 184 160, 174 168" stroke="rgba(10,31,68,0.25)" stroke-width="6" stroke-linecap="round"/>
      </g>

      <!-- feet -->
      <path d="M86 200 C88 186, 96 182, 104 186" stroke="#d4a400" stroke-width="6" stroke-linecap="round"/>
      <path d="M134 200 C132 186, 124 182, 116 186" stroke="#d4a400" stroke-width="6" stroke-linecap="round"/>

      <!-- navy outline accents -->
      <circle cx="110" cy="70" r="52" fill="none" stroke="rgba(10,31,68,0.18)" stroke-width="6"/>
      <ellipse cx="110" cy="130" rx="62" ry="70" fill="none" stroke="rgba(10,31,68,0.18)" stroke-width="6"/>
    </svg>

    <!-- little sparkles -->
    <div class="ruby-spark ruby-spark-1">‚ú®</div>
    <div class="ruby-spark ruby-spark-2">‚ú®</div>
    <div class="ruby-spark ruby-spark-3">‚≠ê</div>
  </div>
</div>


  <div class="jars" id="jars"></div>

  <div class="leaderboard">
    <h2>üèÜ Leaderboard</h2>
    <div class="lbgrid" id="leaderboard"></div>
    <div class="tiny">This updates live when teachers add points.</div>
  </div>

  <!-- Firebase (v9 compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyD0ZrYRin1oQrrgLlGlOxmHvS4eiWpEQgY",
      authDomain: "cafeteria-rewards.firebaseapp.com",
      databaseURL: "https://cafeteria-rewards-default-rtdb.firebaseio.com",
      projectId: "cafeteria-rewards",
      storageBucket: "cafeteria-rewards.firebasestorage.app",
      messagingSenderId: "529945878029",
      appId: "1:529945878029:web:2e6390e70b21770e07bf44",
      measurementId: "G-2VJF6ER094"
    };

    const grades = ["PK","K","1","2","3","4","5","6"];
    const maxPoints = 50;
    const MAX_VISIBLE_TOKENS = 80;

    const jarsEl = document.getElementById("jars");
    const statusEl = document.getElementById("status");
    const lastUpdateEl = document.getElementById("lastUpdate");

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const ref = db.ref("rewards");

    function showRuby(message){
  const pop = document.getElementById("rubyPop");
  if(!pop) return;

  const say = pop.querySelector(".ruby-say");
  if(say && message) say.textContent = message;

  pop.classList.add("show");

  // hide after 2 seconds
  clearTimeout(window.__rubyTimer);
  window.__rubyTimer = setTimeout(() => {
    pop.classList.remove("show");
  }, 2000);
}
    
function showBannerForGrade(grade){
  const pop = document.getElementById("bannerPop");
  const txt = document.getElementById("bannerText");
  if(!pop || !txt) return;

  txt.textContent = `Grade ${grade} is ROCKIN‚Äô it!`;

  pop.classList.add("show");
  clearTimeout(window.__bannerTimer);
  window.__bannerTimer = setTimeout(() => {
    pop.classList.remove("show");
  }, 2000);
}

    function slotPosition(jarEl, index){
      const rect = jarEl.getBoundingClientRect();
      const size = 16, padX = 14, padBottom = 10, gap = 4;
      const usableW = rect.width - padX*2;
      const cols = Math.max(1, Math.floor(usableW / (size + gap)));
      const row = Math.floor(index / cols);
      const col = index % cols;
      const x = padX + (col + 0.5) * (usableW / cols);
      const yFromBottom = (row + 0.5) * (size + gap);
      const y = rect.height - padBottom - yFromBottom;
      const jitter = (n) => (Math.sin((index+1)*999) * 0.5 + 0.5) * n - n/2;
      return { left: x + jitter(6), top: y + jitter(6) };
    }

    function drawTokens(grade, count){
      const jarEl = document.getElementById("jar_" + grade);
      const layer = document.getElementById("tokens_" + grade);
      if(!jarEl || !layer) return;

      const visible = Math.min(count, MAX_VISIBLE_TOKENS);
      layer.innerHTML = "";
      for(let i=0;i<visible;i++){
        const t = document.createElement("div");
        t.className = "token";
        const pos = slotPosition(jarEl, i);
        t.style.left = pos.left + "px";
        t.style.top  = pos.top  + "px";
        layer.appendChild(t);
      }
    }
    function playPointSound(){
  const s = document.getElementById("pointSound");
  if(!s) return;
  s.currentTime = 0;
  s.play().catch(()=>{});
}

 function confetti(){
  const colors = ["#ff5252","#ffd700","#4caf50","#2196f3","#ff8a65","#ab47bc"];
  for(let i=0;i<60;i++){
    const c = document.createElement("div");
    c.className = "confetti";
    c.style.left = Math.random()*100 + "vw";
    c.style.top  = (-10 - Math.random()*30) + "px";
    c.style.background = colors[Math.floor(Math.random()*colors.length)];
    c.style.width = (8 + Math.random()*6) + "px";
    c.style.height = c.style.width;
    document.body.appendChild(c);
    setTimeout(()=>c.remove(), 1100);
  }
}

    function renderUI(){
      jarsEl.innerHTML = "";
      grades.forEach(g=>{
        const card = document.createElement("div");
        card.className = "jar";
        card.innerHTML = `
          <h3>Grade ${g}</h3>
          <div class="jar-lid"></div>
          <div class="jar-body" id="jar_${g}">
            <div class="fill" id="fill_${g}"></div>
            <div class="tokens" id="tokens_${g}"></div>
          </div>
          <div class="points" id="pts_${g}">0</div>
          <div class="tiny">Tokens stack as points grow</div>
        `;
        jarsEl.appendChild(card);
      });
    }

    function updateLeaderboard(points){
      const board = document.getElementById("leaderboard");
      board.innerHTML = "";
      const sorted = [...grades].sort((a,b)=>(points[b]||0)-(points[a]||0));
      sorted.forEach(g=>{
        const item = document.createElement("div");
        item.className = "lbitem";
        item.innerHTML = `<strong>Grade ${g}</strong><br>${points[g]||0} points`;
        board.appendChild(item);
      });
    }

    let lastTs = 0;
    renderUI();

    ref.on("value", snap=>{
      statusEl.textContent = "‚úÖ Live";
      const data = snap.val() || {};
      const points = data.points || {};
      const event = data.lastEvent || null;

      grades.forEach(g=>{
        const v = points[g] || 0;
        const ptsEl = document.getElementById("pts_"+g);
        const fillEl = document.getElementById("fill_"+g);
        if(ptsEl) ptsEl.textContent = v;
        if(fillEl) fillEl.style.height = Math.min((v/maxPoints)*100, 100) + "%";
        drawTokens(g, v);
      });

      updateLeaderboard(points);

    if(event && event.ts && event.ts > lastTs){
  lastTs = event.ts;
  lastUpdateEl.textContent = "Last update: " + new Date(event.ts).toLocaleTimeString();
if(event.type === "add"){
  confetti();
  playPointSound();

  // Show Ruby banner on big add (like +5)
  if((event.amount || 1) >= 5){
    showBannerForGrade(event.grade || "");
  }
}


      } else {
        lastUpdateEl.textContent = "Last update: " + new Date().toLocaleTimeString();
      }
    }, err=>{
      statusEl.textContent = "‚ö†Ô∏è Not connected";
      console.error(err);
    });
    
    <!-- +5 Celebration Banner -->
<div id="bannerPop" class="banner-pop" aria-hidden="true">
  <div class="banner-wrap">
    <img class="banner-img" src="https://github.com/mnickelson-tech/Cafeteria-rewards/blob/main/ruby-banner.png" alt="Ruby banner" />
    <div class="banner-text" id="bannerText">Grade 3 is ROCKIN‚Äô it!</div>
  </div>
</div>


    window.addEventListener("resize", ()=>{
      ref.get().then(snap=>{
        const data = snap.val() || {};
        const points = (data.points || {});
        grades.forEach(g => drawTokens(g, points[g]||0));
      });
    });
  </script>
</body>
</html>



